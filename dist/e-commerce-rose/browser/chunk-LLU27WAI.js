import{a as ce}from"./chunk-S66TH3FU.js";import{c as pe}from"./chunk-ZVFUU2IN.js";import{e as le}from"./chunk-MJN5VWZP.js";import"./chunk-WLPYMJ5B.js";import"./chunk-U6POVDGM.js";import{c as ne,d as j,f as k,g as U,i as z,o as se}from"./chunk-QZHVMEMD.js";import{Bb as G,Da as f,Ga as m,Hb as J,Ib as K,Ja as D,Jb as Q,Ma as L,Pb as W,R as y,Ra as r,Sa as o,Ta as _,Tb as X,Ua as w,Ub as Z,Va as S,Wa as A,Xa as T,Ya as u,Z as I,_ as E,a as b,b as C,db as R,eb as s,fb as $,gb as p,hb as q,ka as B,lc as ee,mc as te,nb as V,ob as O,pa as N,pb as M,qb as H,rc as ie,ta as a,tb as c,tc as ae,ub as d,uc as oe,vc as re,xb as Y,ya as F}from"./chunk-XFMLYWXN.js";var me=()=>[1,2,3],ge=(n,t)=>({"left-0":n,"right-0":t}),ue=(n,t)=>({"bg-[#30B479]":n,"bg-red-600":t}),_e=n=>({"max-w-[125px]":n}),fe=(n,t,e)=>["/",n,"policies",t,e],xe=n=>({"!text-red-600":n});function ve(n,t){n&1&&(r(0,"div",13)(1,"div",14)(2,"div",15),_(3,"div",16)(4,"div",17),o(),_(5,"div",18),o(),r(6,"div",19)(7,"div"),_(8,"div",20)(9,"div",21),o(),r(10,"div"),_(11,"div",20)(12,"div",21),o(),r(13,"div",22),_(14,"div",20)(15,"div",21),o()(),r(16,"div",23),_(17,"div",24),o()())}function ye(n,t){n&1&&(r(0,"div",11),f(1,ve,18,0,"div",12),o()),n&2&&(a(),m("ngForOf",V(1,me)))}function he(n,t){if(n&1&&(r(0,"div",29),s(1),c(2,"translate"),c(3,"translate"),o()),n&2){let e=u(2);m("ngClass",M(7,ge,e.lang==="en",e.lang==="ar")),a(),q(" ",e.expiringSoonCount," ",e.expiringSoonCount===1?d(2,3,"pages.user_policies.expiring_soon_singular"):d(3,5,"pages.user_policies.expiring_soon_plural")," ")}}function be(n,t){n&1&&(w(0),r(1,"div",30),s(2),c(3,"translate"),o(),S()),n&2&&(a(2),p(" ",d(3,1,"pages.user_policies.no_data")," "))}function Ce(n,t){n&1&&(r(0,"div",43),s(1),c(2,"translate"),o()),n&2&&(a(),p(" ",d(2,1,"pages.user_policies.expiring_soon")," "))}function we(n,t){n&1&&(s(0),c(1,"translate")),n&2&&p(" ",d(1,1,"Professional.title")," ")}function Se(n,t){if(n&1&&s(0),n&2){let e=u().$implicit,i=u(2);p(" ",i.getPolicyTypeName(e.type)," ")}}function Pe(n,t){if(n&1&&(r(0,"div",22)(1,"div",38),s(2),c(3,"translate"),o(),r(4,"div",44),s(5),o()()),n&2){let e=u().$implicit,i=u(2);a(2),p(" ",d(3,3,"pages.user_policies.labels.expiry_date")," "),a(2),m("ngClass",O(5,xe,i.getPolicyStatus(e.type,e)==="Canceled"||i.getPolicyStatus(e.type,e)==="Expired")),a(),p(" ",i.formatDisplayDate(e.end_date)," ")}}function Ie(n,t){if(n&1&&(r(0,"div")(1,"div",38),s(2),c(3,"translate"),o(),r(4,"div",39),s(5),o()()),n&2){let e=u(2).$implicit;a(2),p(" ",d(3,2,"pages.user_policies.labels.company_employee_number")," "),a(3),p(" ",e.company_employee_number," ")}}function Ee(n,t){if(n&1&&(r(0,"div")(1,"div",38),s(2),c(3,"translate"),o(),r(4,"div",39),s(5),o()()),n&2){let e=u(2).$implicit;a(2),p(" ",d(3,2,"pages.user_policies.labels.company_building_number")," "),a(3),p(" ",e.company_building_number," ")}}function De(n,t){if(n&1&&(r(0,"div"),f(1,Ie,6,4,"div",45)(2,Ee,6,4,"ng-template",null,0,Y),o()),n&2){let e=R(3),i=u().$implicit;a(),m("ngIf",i.company_employee_number)("ngIfElse",e)}}function Te(n,t){if(n&1&&(w(0),r(1,"div",31),f(2,Ce,3,3,"div",32),r(3,"div",14)(4,"div")(5,"div",33),_(6,"div",34),f(7,we,2,3)(8,Se,1,1),o(),r(9,"div",35),s(10),o()(),r(11,"div",36),_(12,"img",37),c(13,"translate"),o()(),r(14,"div",19)(15,"div")(16,"div",38),s(17),c(18,"translate"),o(),r(19,"div",39),s(20),o()(),r(21,"div")(22,"div",38),s(23),c(24,"translate"),o(),r(25,"div",39),s(26),o()(),f(27,Pe,6,7,"div",40),r(28,"div")(29,"div",38),s(30),c(31,"translate"),o(),r(32,"div",39),s(33),c(34,"translate"),o()(),f(35,De,4,2,"div",7),o(),r(36,"div",23)(37,"button",41),c(38,"async"),s(39),c(40,"translate"),o()(),_(41,"img",42),c(42,"translate"),o(),S()),n&2){let e=t.$implicit,i=u(2);a(2),m("ngIf",i.isExpiringSoon(e.end_date)&&i.getPolicyStatus(e.type,e)==="Running"),a(4),m("ngClass",M(34,ue,i.getPolicyStatus(e.type,e)==="Running"||i.getPolicyStatus(e.type,e)==="Pending"||i.getPolicyStatus(e.type,e)==="Requested",i.getPolicyStatus(e.type,e)==="Canceled"||i.getPolicyStatus(e.type,e)==="Expired")),a(),L(e.type=="jop"?7:8),a(3),p(" ",i.getPolicyStatus(e.type,e)," "),a(2),m("src",e.type==="medical"?"/assets/policies/medical.png":e.type==="motor"?"/assets/policies/car.png":e.type==="jop"?"/assets/policies/job.webp":"/assets/policies/building.png",N)("alt",d(13,18,"pages.user_policies.images."+e.type+"_alt"))("ngClass",O(37,_e,e.type=="jop")),a(5),p(" ",d(18,20,"pages.user_policies.labels.policy_holder")," "),a(3),$(e.name),a(3),p(" ",d(24,22,"pages.user_policies.labels.policy_code")," "),a(3),p(" ",i.getPolicyCode(e,e.type)," "),a(),m("ngIf",e.end_date),a(3),p(" ",d(31,24,"pages.user_policies.labels.request_type")," "),a(3),p(" ",d(34,26,"pages.user_policies.request_type."+(e.request_type||"individual"))," "),a(2),m("ngIf",e.request_type==="corporate"),a(2),m("routerLink",H(39,fe,d(38,28,i.currentLang$),e.id,e.type==="jop"?"job":e.type)),a(2),p(" ",d(40,30,"pages.user_policies.buttons.show_all_details")," "),a(2),m("alt",d(42,32,"pages.user_policies.images.card_background_alt"))}}function Oe(n,t){if(n&1){let e=A();w(0),r(1,"div",25)(2,"button",26),T("click",function(){I(e);let l=u();return E(l.switchTab("current"))}),s(3),c(4,"translate"),f(5,he,4,10,"div",27),o(),r(6,"button",26),T("click",function(){I(e);let l=u();return E(l.switchTab("previous"))}),s(7),c(8,"translate"),o()(),f(9,be,4,3,"ng-container",7)(10,Te,43,43,"ng-container",28),S()}if(n&2){let e=u();a(2),D(e.activeTab==="current"?"select-btn active w-1/2 relative":"select-btn w-1/2 relative"),a(),p(" ",d(4,9,"pages.user_policies.tabs.current")," "),a(2),m("ngIf",e.expiringSoonCount>0),a(),D(e.activeTab==="previous"?"select-btn active w-1/2 relative":"select-btn w-1/2 relative"),a(),p(" ",d(8,11,"pages.user_policies.tabs.previous")," "),a(2),m("ngIf",e.getAllPoliciesSorted().length===0),a(),m("ngForOf",e.getAllPoliciesSorted())}}var de=class n{activeTab="current";policies={user:null,medical:[],motor:[],building:[],jop:[]};isLoading=!0;expiringSoonCount=0;policiesService=y(ce);authService=y(le);platformId=y(B);router=y(ee);languageService=y(se);translate=y(ae);policyTypes=["medical","motor","building","jop"];currentLang$=this.languageService.currentLanguage$;cdr=y(G);lang="en";ngOnInit(){if(Z(this.platformId)){if(!this.authService.isAuthenticated()){this.router.navigate(["/",this.languageService.getCurrentLanguage()]);return}this.fetchPolicies()}this.languageService.currentLanguage$.subscribe(t=>{this.lang=t})}fetchPolicies(){let t=+this.authService.getUserId();if(!t){this.isLoading=!1;return}this.isLoading=!0,this.policiesService.getUserPolicies(t).subscribe({next:e=>{this.policies=e,this.expiringSoonCount=this.calculateExpiringSoonCount(),this.isLoading=!1,this.cdr.markForCheck()},error:()=>{this.isLoading=!1,this.cdr.markForCheck()}})}calculateExpiringSoonCount(){return[...this.policies.medical.filter(t=>this.isExpiringSoon(t.end_date)&&this.getPolicyStatus("medical",t)==="Running"),...this.policies.motor.filter(t=>this.isExpiringSoon(t.end_date)&&this.getPolicyStatus("motor",t)==="Running"),...this.policies.building.filter(t=>this.isExpiringSoon(t.end_date)&&this.getPolicyStatus("building",t)==="Running"),...this.policies.jop.filter(t=>this.isExpiringSoon(t.end_date)&&this.getPolicyStatus("jop",t)==="Running")].length}switchTab(t){this.activeTab=t}formatInputDate(t){if(!t)return null;let e=t.split(/[-\/]/),i,l,g;if(e[0].length===4)[i,l,g]=e.map(Number);else if(e[2].length===4)[g,l,i]=e.map(Number);else return null;if(isNaN(i)||isNaN(l)||isNaN(g))return null;let x=new Date(i,l-1,g);return isNaN(x.getTime())?null:x}formatDisplayDate(t){let e=this.formatInputDate(t);if(!e)return this.translate.instant("pages.user_policies.na");let i=e.getDate().toString().padStart(2,"0"),l=e.toLocaleString("en-US",{month:"long"}),g=e.getFullYear();return`${i}, ${l} ${g}`}isExpiringSoon(t){let e=this.formatInputDate(t);if(!e)return!1;let i=new Date;i.setHours(0,0,0,0);let l=new Date(i);return l.setDate(i.getDate()+10),e>=i&&e<=l}getAllPoliciesSorted(){let e=[...this.policies.medical.map(i=>C(b({},i),{type:"medical"})),...this.policies.motor.map(i=>C(b({},i),{type:"motor"})),...this.policies.building.map(i=>C(b({},i),{type:"building"})),...this.policies.jop.map(i=>C(b({},i),{type:"jop"}))].filter(i=>{let l=i.active_status==="canceled",g=i.active_status==="pending",x=i.active_status==="requested",h=i.active_status==="confirmed",v=this.formatInputDate(i.end_date),P=new Date;return P.setHours(0,0,0,0),this.activeTab==="current"?g||x||h&&v!==null&&v>=P:!g&&!x&&(l||v!==null&&v<P||h&&!v)});return console.log(e),e.sort((i,l)=>{let g=i.created_at?new Date(i.created_at):new Date(0);return(l.created_at?new Date(l.created_at):new Date(0)).getTime()-g.getTime()})}getPolicyStatus(t,e){let i=e.active_status==="canceled",l=e.active_status==="pending",g=e.active_status==="requested",x=e.active_status==="confirmed",h=this.formatInputDate(e.end_date),v=new Date;return v.setHours(0,0,0,0),i?this.translate.instant("pages.user_policies.status.canceled"):l?this.translate.instant("pages.user_policies.status.pending"):g?this.translate.instant("pages.user_policies.status.requested"):(x&&this.translate.instant("pages.user_policies.status.confirmed"),!h||h<v?this.translate.instant("pages.user_policies.status.expired"):this.translate.instant("pages.user_policies.status.running"))}getPolicyTypeName(t){return this.translate.instant(`pages.user_policies.types.${t}`)}getPolicyCode(t,e){return e==="medical"?t.medical_insurance_number:e==="motor"?t.motor_insurance_number:e==="building"?t.building_insurance_number:t.jop_insurance_number}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-user-policies"]],decls:10,vars:3,consts:[["buildNum",""],[1,"min-h-screen","bg-white","p-4","sm:p-6"],[1,"max-w-7xl","mx-auto"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","lg:gap-8"],[1,"space-y-4","sm:space-y-6"],[1,"space-y-3","sm:space-y-4"],["class","space-y-3",4,"ngIf"],[4,"ngIf"],[1,"hidden","lg:block","sticky","top-6","self-start"],[1,"w-full","max-h-[600px]","rounded-4xl","overflow-hidden"],["src","assets/claims/claims-img.jpg","alt","",1,"w-full","h-full","object-cover","object-top"],[1,"space-y-3"],["class","card relative animate-pulse",4,"ngFor","ngForOf"],[1,"card","relative","animate-pulse"],[1,"status","flex","justify-between","items-center","flex-wrap"],[1,"flex","gap-2","items-center"],[1,"status-dot","bg-gray-300","w-4","h-4","rounded-full"],[1,"h-6","w-32","bg-gray-200","rounded"],[1,"w-[170px]","h-[70px]","bg-gray-200","rounded"],[1,"info-grid"],[1,"h-4","w-20","bg-gray-200","rounded"],[1,"h-5","w-40","bg-gray-200","rounded"],[1,"expiry"],[1,"flex","items-center","gap-2","justify-between"],[1,"h-8","w-32","bg-gray-200","rounded"],[1,"flex","gap-2","w-full"],[3,"click"],["class","absolute right-0 -top-2.5  bg-gradient-to-r from-red-500 to-yellow-500 text-white text-xs p-1 rounded font-medium  rounded-bl-md shadow-md transform origin-top-end",3,"ngClass",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"absolute","right-0","-top-2.5","bg-gradient-to-r","from-red-500","to-yellow-500","text-white","text-xs","p-1","rounded","font-medium","rounded-bl-md","shadow-md","transform","origin-top-end",3,"ngClass"],[1,"text-center","text-gray-500","text-lg","py-8"],[1,"card","relative"],["class","absolute top-0 right-0 bg-yellow-400 text-black text-sm font-semibold px-3 py-1 rounded-bl-lg z-30 transform -rotate-2 shadow-md",4,"ngIf"],[1,"flex","gap-2","items-center","policy-type"],[1,"status-dot",3,"ngClass"],[1,"subtext"],[1,"w-[170px]","h-[85px]","z-20","text-center","flex","justify-center"],[1,"w-full","h-full","object-cover",3,"src","alt","ngClass"],[1,"label"],[1,"value"],["class","expiry",4,"ngIf"],[1,"show-all-details","w-full","md:w-1/2",3,"routerLink"],["src","/assets/policies/card-policy-bg.svg",1,"car-img","absolute","-top-5","-end-5","w-[180px]","z-10","h-[180px]",3,"alt"],[1,"absolute","top-0","right-0","bg-yellow-400","text-black","text-sm","font-semibold","px-3","py-1","rounded-bl-lg","z-30","transform","-rotate-2","shadow-md"],[1,"value",3,"ngClass"],[4,"ngIf","ngIfElse"]],template:function(e,i){e&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5),f(5,ye,2,2,"div",6)(6,Oe,11,13,"ng-container",7),o()(),r(7,"div",8)(8,"div",9),_(9,"img",10),o()()()()()),e&2&&(m("@fadeInOut",i.isLoading?"loading":"loaded"),a(5),m("ngIf",i.isLoading),a(),m("ngIf",!i.isLoading))},dependencies:[X,J,K,Q,W,ie,te,re,oe,pe],styles:[".show-details-btn[_ngcontent-%COMP%]{width:50%;height:80px;flex-shrink:0;color:#fff;font-family:Alexandria;font-size:23px;font-style:normal;font-weight:400;line-height:65px;text-transform:capitalize}.select-btn[_ngcontent-%COMP%]{flex-shrink:0;border-radius:15px;color:#676767;font-family:Alexandria;font-size:clamp(18px,1.5vw,23px);font-style:normal;font-weight:500;text-transform:capitalize;padding:1rem 3rem;box-shadow:0 4px 4px #00000040}.select-btn.active[_ngcontent-%COMP%]{background:#37a6de;color:#fff}.renew-now[_ngcontent-%COMP%]{border-radius:30px;border:1px solid #37A6DE;background:#fff;padding:1rem 3rem;box-shadow:0 4px 4px #00000040;color:#37a6de;font-family:Alexandria;font-size:clamp(18px,1.5vw,23px);font-style:normal;font-weight:400;text-transform:capitalize;width:50%;transition:.4s}.renew-now[_ngcontent-%COMP%]:hover{background-color:#199be0;color:#fff}.card[_ngcontent-%COMP%]{padding:2rem;border-radius:15px;border:1px solid rgba(103,103,103,0);box-shadow:0 4px 4px #00000040;overflow:hidden}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#000;text-align:center;font-family:Alexandria;font-size:23px;font-style:normal;font-weight:500;line-height:22px;text-transform:capitalize}.status[_ngcontent-%COMP%]{color:#000;font-family:Alexandria;font-size:16px;font-style:normal;font-weight:300;line-height:22px;text-transform:capitalize}.status-dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%}.subtext[_ngcontent-%COMP%]{color:#555;margin-bottom:16px;margin-top:1rem}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:2rem;margin-bottom:12px;justify-content:start}.label[_ngcontent-%COMP%]{color:#3c3c3c;font-family:Alexandria;font-size:16px;font-style:normal;font-weight:300;line-height:22px;text-transform:capitalize}.value[_ngcontent-%COMP%]{color:#000;font-family:Alexandria;font-size:18px;font-style:normal;font-weight:400;line-height:22px;margin-top:.8rem;text-transform:capitalize}.expiry[_ngcontent-%COMP%]{margin-bottom:20px}.show-all-details[_ngcontent-%COMP%]{padding:clamp(1rem,1vw,2rem) clamp(1rem,2vw,3rem);flex-shrink:0;border-radius:30px;background:#37a6de;color:#fff;font-family:Alexandria;font-size:clamp(18px,1.5vw,23px);font-style:normal;font-weight:400;text-transform:capitalize;transition:.4s}.show-all-details[_ngcontent-%COMP%]:hover{background-color:#199be0}.policy-type[_ngcontent-%COMP%]{color:#000;text-align:center;font-family:Alexandria;font-size:23px;font-style:normal;font-weight:500;line-height:22px;text-transform:capitalize}"],data:{animation:[ne("fadeInOut",[U("loading",k({opacity:.7})),U("loaded",k({opacity:1})),z("loading => loaded",[j("0.5s ease-in")]),z("loaded => loading",[j("0.3s ease-out")])])]}})};export{de as UserPoliciesComponent};
