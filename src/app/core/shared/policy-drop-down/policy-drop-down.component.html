<div class="relative w-full h-[65px]">
  <div
    class="flex h-full ps-[30px] pe-[15px] items-center border border-gray-300 rounded-[16px] py-2 bg-white focus-within:border-[#1D9BF0] transition-colors"
    [ngClass]="{ 'border-red-500': !selectedGovernorate && showError }"
  >
    <div class="flex-1 flex items-center">
      <div
        *ngIf="selectedGovernorate && !isDropdownOpen"
        (click)="onSelectedValueClick()"
        class="inline-flex items-center h-full px-3 py-1 rounded-full border text-sm font-medium bg-[#1D9BF0] text-white border-[#1D9BF0] shadow-md cursor-pointer hover:bg-blue-600 transition-colors"
      >
        {{
          translate.currentLang === "ar"
            ? selectedGovernorate.ar_name || selectedGovernorate.name
            : selectedGovernorate.en_name || selectedGovernorate.name
        }}
      </div>

      <input
        *ngIf="!selectedGovernorate || isDropdownOpen"
        type="text"
        class="flex-1 outline-none w-full text-right"
        [ngClass]="{
          'text-right': translate.currentLang === 'ar',
          'text-left': translate.currentLang === 'en'
        }"
        [placeholder]="hasData ? placeholder : 'Loading...'"
        [value]="searchValue"
        [disabled]="!hasData"
        (focus)="onInputFocus()"
        (input)="onInputChange($event)"
        autocomplete="off"
        #searchInput
      />
    </div>

    <button
      *ngIf="selectedGovernorate"
      (click)="clearSelection()"
      class="ml-2 text-gray-500 hover:text-red-500 transition-colors cursor-pointer"
      type="button"
    >
      âœ–
    </button>

    <svg
      (click)="toggleDropdown()"
      class="w-6 h-6 ml-2 text-gray-400 transition-transform cursor-pointer hover:text-gray-600"
      [class.rotate-180]="isDropdownOpen"
      xmlns="http://www.w3.org/2000/svg"
      width="23"
      height="23"
      viewBox="0 0 23 23"
      fill="none"
    >
      <path
        d="M15.3333 10.5417L11.5 14.375L7.66667 10.5417M11.5 20.125C16.2635 20.125 20.125 16.2635 20.125 11.5C20.125 6.73655 16.2635 2.875 11.5 2.875C6.73655 2.875 2.875 6.73655 2.875 11.5C2.875 16.2635 6.73655 20.125 11.5 20.125Z"
        stroke="black"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
  </div>

  <div
    *ngIf="isDropdownOpen && hasData"
    class="absolute bg-white border max-w-2xl right-0 rounded-md mt-1 p-2 w-full shadow-lg z-50 max-h-60 overflow-y-auto"
  >
    <div
      *ngIf="filteredGovernorates.length === 0"
      class="text-gray-500 text-center py-2"
    >
      {{ "pages.motor_policy.form.no_results" | translate }}
    </div>

    <!-- Display results in grid -->
    <div *ngIf="filteredGovernorates.length > 0" class="grid grid-cols-3 gap-2">
      <button
        *ngFor="let gov of filteredGovernorates; trackBy: trackByFn"
        (click)="selectGovernorate(gov)"
        [class]="getButtonClasses(gov)"
        class="px-3 py-2 cursor-pointer rounded-full border text-sm font-medium transition-all duration-200 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-300"
        type="button"
      >
        {{
          translate.currentLang === "ar"
            ? gov.ar_name || gov.name
            : gov.en_name || gov.name
        }}
      </button>
    </div>
  </div>

  <div
    *ngIf="!hasData && isDropdownOpen"
    class="absolute bg-white border rounded-md mt-1 p-4 w-full shadow-lg z-50"
  >
    <div class="text-gray-500 text-center">
      <div
        class="animate-spin rounded-full h-6 w-6 border-b-2 border-[#1D9BF0] mx-auto mb-2"
      ></div>
      {{ "pages.motor_policy.form.loading" | translate }}
    </div>
  </div>
</div>
